(function(A){A.fn.jscrollbar=function(E){var C={color:"black",width:12,opacity:0.6,borderRadius:6,position:"outer",keyControl:true,mouseScrollDirection:"vertical",keyMoveAmount:30,mouseMoveAmount:30},D="jscrollbar",F=this.data(D);if(typeof E==="string"){if(F){if(E==="getObject"){return F}else{if(F[E]){F[E].apply(F,Array.prototype.slice.call(arguments,1))}return this}}else{throw new Error("This object is not available!")}}return this.each(function(){var G=new B(A(this),A.extend({},C,E));A(this).data(D,G)})};function B(L,N){this.obj=L;this.opts=N;var G=this;E();this.width=L.width();this.height=L.height();this.scrollWidth=L[0].scrollWidth;this.scrollHeight=L[0].scrollHeight;this.barXWidth=Math.min(this.width-this.opts.width-10,Math.max(10,this.width*this.width/this.scrollWidth));this.barYHeight=Math.min(this.height-this.opts.width-10,Math.max(10,this.height*this.height/this.scrollHeight));this.$sbContent=F();this.barX=undefined;this.barY=undefined;this.barXmaxX=0;this.barYmaxY=0;this.barXB=null;this.barYB=null;D();J();C();I();function F(){G.obj.css({"overflow":"hidden"}).wrapInner('<div class="sb-Content" style="overflow:hidden;position:relative"></div>');var O=G.obj.children(".sb-Content").scrollTop(0).scrollLeft(0);if(A.browser.mozilla){A(document).ready(function(){O.scrollTop(0)})}return O}function H(P){var Q=G.opts.color,O=G.opts.width;if(/x/i.test(P)){G.barXB=A('<div style="position:absolute;font-size:0;background:'+Q+";opacity:0.2;filter:alpha(opacity=20);width:100%;height:"+O+'px;left:0;bottom:0;"></div>').appendTo(G.obj).bind("mousedown",function(S){var R=Math.max(Math.min(S.pageX-A(this).offset().left-G.barX.width()/2,G.barXmaxX),0);G.barX.stop().animate({left:R},300);G._updateContentLoc({direction:"x","barXLocLeft":R,"duration":300});return false})}if(/y/i.test(P)){G.barYB=A('<div style="font-size:0;position:absolute;background:'+Q+";opacity:0.2;filter:alpha(opacity=20);width:"+O+'px;height:100%;right:0;top:0"></div>').appendTo(G.obj).bind("mousedown",function(S){var R=Math.max(Math.min(S.pageY-A(this).offset().top-G.barY.height()/2,G.barYmaxY),0);G.barY.stop().animate({top:R},300);G._updateContentLoc({direction:"y","barYLocTop":R,"duration":300});return false})}}function I(){G.obj.mousewheel&&(G.obj.mousewheel(function(T){var R={"horizontal":"x","vertical":"y"},S=(T<0?1:-1)*G.opts.mouseMoveAmount,Q=G.opts.mouseScrollDirection,P=G.opts.showXBar,O=G.opts.showYBar;if(Q=="horizontal"&&!P&&O){Q="vertical"}if(Q=="vertical"&&!O&&P){Q="horizontal"}G.scrollBy(R[Q],S)}))}function E(){var O=G.obj.css({"overflow":"auto"}).css("position");if(/(static)/ig.test(O)){G.obj.css({position:"relative"})}}function K(Q){var O=G.opts.width,T=G.opts.position,R={},P=G.opts.opacity,S='<div class="jq-scrollbar" style="font-size:0;border-radius:6px;background:'+G.opts.color+";position:absolute;z-index:1;border-radius:"+N.borderRadius+";opacity:"+P+";filter:alpha(opacity="+P*100+");";if(/x/i.test(Q)){G.opts.showXBar=true;G.barX=this.barX=A(S+"bottom:0;left:0;width:"+G.barXWidth+"px;height:"+O+'px;"></div>').appendTo(G.obj);if(T==="outer"){R.height=(G.height-O)+"px";H("x")}else{R.height=G.height+"px"}}else{if(/y/i.test(Q)){G.opts.showYBar=true;G.barY=A(S+";right:0;top:0;width:"+O+"px;height:"+G.barYHeight+'px;"></div>').appendTo(G.obj);if(T==="outer"){R.width=(G.width-O)+"px";H("y")}else{R.width=G.width+"px"}}}G.$sbContent.css(R)}function M(O){if(/x/i.test(O)&&G.barX){G.barX.jqdrag({type:"x",maxX:G.barXmaxX,minX:0,ondrag:function(){G._updateContentLoc({direction:"x"})},ondragend:function(){G._triggerEvent("x","finished")}})}if(/y/.test(O)&&G.barY){G.barY.jqdrag({type:"y",maxY:G.barYmaxY,minY:0,ondrag:function(){G._updateContentLoc({direction:"y"})},ondragend:function(){G._triggerEvent("y","finished")}})}}function D(){var P=G.opts.showXBar;var O=G.opts.showYBar;if((P!==false)&&(G.scrollWidth>G.width)){K("x");if((O!==false)&&(G.scrollHeight>G.$sbContent.height())){K("y")}}if((O!==false)&&(typeof G.barY==="undefined")&&(G.scrollHeight>G.height)){K("y");if((P!==false)&&(typeof G.barX==="undefined")&&(G.$sbContent[0].scrollWidth>G.$sbContent.width())){K("x")}}if(!N.showYBar){G.$sbContent.css({"width":G.width+"px"})}if(!N.showXBar){G.$sbContent.css({"height":G.height+"px"})}G.barX&&(G.barXmaxX=G.width-G.barX.width()-((N.position==="inner"||!G.opts.showYBar)?0:G.opts.width));G.barY&&(G.barYmaxY=G.height-G.barY.height()-((N.position==="inner"||!G.opts.showXBar)?0:G.opts.width));M("xy")}function J(){var S=G.opts.position,Q=G.opts.opacity,P={opacity:0},O={"opacity":Q};if(S==="outer"){}else{var R=G.obj.find(".jq-scrollbar").animate(P,1000);G.obj.hover(function(){R.stop().animate(O,500)},function(){R.stop().animate(P,1000)})}}function C(){if(G.opts.keyControl){G.$sbContent.hover(function(){A(document).bind("keydown.jsb",function(P){var O=P.keyCode;switch(O){case 37:G.scrollBy("x",-G.opts.keyMoveAmount);break;case 38:G.scrollBy("y",-G.opts.keyMoveAmount);break;case 39:G.scrollBy("x",G.opts.keyMoveAmount);break;case 40:G.scrollBy("y",G.opts.keyMoveAmount);break}/(37|38|39|40)/.test(O)&&P.preventDefault()})},function(){A(document).unbind("keydown.jsb")})}}}B.prototype={getScrollPos:function(){var C=this.$sbContent[0];return{x:C.scrollLeft,y:C.scrollTop}},setBarLoc:function(){var E=this.getScrollPos(),C=this.barX,D=this.barY;C&&C.css({"left":this.barXmaxX*E.x/(this.scrollWidth-this.width)});D&&D.css({"top":this.barYmaxY*E.y/(this.scrollHeight-this.height)});return this},scrollBy:function(C,D){this.scrollTo(C,this.getScrollPos()[C]+D);return this},scrollTo:function(C,D){var E=C=="x"?"scrollLeft":"scrollTop";this.$sbContent[E](D);this.setBarLoc();this._triggerEvent(C,"scroll");return this},_triggerEvent:function(C,D,F){if(F){this.obj.trigger(D,[F]);return}var E=C=="x"?+(parseFloat(this.barX.css("left"),10)/this.barXmaxX*100).toFixed(2):+(parseFloat(this.barY.css("top"),10)/this.barYmaxY*100).toFixed(2);this.obj.trigger(D,[{direction:C,percent:E,scrollWidth:this.scrollWidth,scrollHeight:this.scrollHeight}])},updateUI:function(){this.width=this.obj.width();this.height=this.obj.height();this.$sbContent.css({"width":this.barY?this.width-this.opts.width:this.width,"height":this.barX?this.height-this.opts.width:this.height});this.scrollWidth=this.$sbContent[0].scrollWidth;this.scrollHeight=this.$sbContent[0].scrollHeight;this.barXWidth=Math.min(this.width-this.opts.width-10,Math.max(10,this.width*this.width/this.scrollWidth));this.barYHeight=Math.min(this.height-this.opts.width-10,Math.max(10,this.height*this.height/this.scrollHeight));if(this.barX){this.barXmaxX=this.width-this.barXWidth-((this.opts.position==="inner"||!this.opts.showYBar)?0:this.opts.width);this.barX.css({"width":this.barXWidth});this.barX.jqdrag("setOption",{"maxX":this.barXmaxX})}if(this.barY){this.barYmaxY=this.height-this.barYHeight-((this.opts.position==="inner"||!this.opts.showXBar)?0:this.opts.width);this.barY.css({"height":this.barYHeight});this.barY.jqdrag("setOption",{"maxY":this.barYmaxY})}return this.setBarLoc()},_updateContentLoc:function(M){var M=A.extend({direction:"xy",duration:0},M),C=M.direction,J=M.barXLocLeft,K=M.barYLocTop,L=typeof J==="undefined",G=typeof K==="undefined",D=M.duration,I=this.$sbContent,H=this,F=0,E=0;if(/y/.test(C)&&this.barY){E=(!G?K:parseFloat(this.barY.css("top")))/this.barYmaxY;F=(I[0].scrollHeight-I.height())*E;I.stop().animate({"scrollTop":F},D,function(){H._triggerEvent("y","scroll",{direction:"y",percent:+(E*100).toFixed(2),scrollWidth:H.scrollWidth,scrollHeight:H.scrollHeight})})}if(/x/.test(C)&&this.barX){E=(!L?J:parseFloat(this.barX.css("left")))/this.barXmaxX;F=(this.scrollWidth-this.width)*E;I.stop().animate({"scrollLeft":F},D,function(){H._triggerEvent("x","scroll",{direction:"x",precent:+(E*100).toFixed(2),scrollWidth:H.scrollWidth,scrollHeight:H.scrollHeight})})}}}})(jQuery);