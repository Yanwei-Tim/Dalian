<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
	"http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="ZdryShbzdryxxb">
	
	<typeAlias alias="zdryShbzdryxxb" type="com.founder.zdry.bean.ZdryShbzdryxxb" />
	<typeAlias alias="zdryZdryzb" type="com.founder.zdry.bean.ZdryZdryzb" />
	
	<!-- 查询单条（根据主键） -->
	<select id="queryById" parameterClass="String" resultClass="zdryShbzdryxxb">
		<![CDATA[ select * from ZDRY_SHBZDRYXXB t where ID = #id# and XT_ZXBZ = '0' and rownum = 1 ]]>
	</select>

	<!-- 新增 -->
	<insert id="save" parameterClass="zdryShbzdryxxb">
		   <![CDATA[ insert into ZDRY_SHBZDRYXXB (ID,SFSWDM,AJLBDM,ZATDDM,JYAQ,CFJG,JCHDDQ,JL,ZWBH,SJMJ,RKBM,BZ,]]><include refid="insertXtzd"/>)
		   <![CDATA[ values (#id#,#sfswdm#,#ajlbdm#,#zatddm#,#jyaq#,#cfjg#,#jchddq#,#jl#,#zwbh#,#sjmj#,#rkbm#,#bz#,]]>
			<include refid="insertXtzdVal"/>)
	</insert>
	
	<select id="queryZsxxById" parameterClass="String" resultClass="zdryShbzdryxxb">
		<![CDATA[ select t.id , t.sfswdm,t.ajlbdm,t.zatddm,t.jyaq,t.cfjg,t.jchddq,t.jl,t.zwbh,t.sjmj, t.sjmj,t1.zdlgbmmc xt_lrrbm , (select wm_concat(t2.zdrylbdm) from zdry_zdrylbb t2 where t2.zdryid = t.id and t2.xt_zxbz='0' ) as bz
  				from ZDRY_SHBZDRYXXB t, ZDRY_ZDRYZB t1 where t.ID = #id#  and t.id=t1.id and t.XT_ZXBZ = '0' and t1.xt_zxbz='0']]>
	</select>
	
	<!-- 更新 -->
	<update id="update" parameterClass="zdryShbzdryxxb">
		<![CDATA[ update ZDRY_SHBZDRYXXB ]]>	
		<dynamic prepend="set">
			<isNotNull prepend="," property="xxsb"><![CDATA[ xxsb = #xxsb#]]></isNotNull>
			<isNotNull prepend="," property="sfyy"><![CDATA[sfyy = #sfyy#]]></isNotNull>
			<isNotNull prepend="," property="jkbm"><![CDATA[jkbm= #jkbm#]]></isNotNull>
			<isNotNull prepend="," property="jkjbdm"><![CDATA[ jkjbdm=#jkjbdm#]]></isNotNull>
			<isNotNull prepend="," property="sfrylbdm"><![CDATA[ sfrylbdm=#sfrylbdm#]]></isNotNull>
			<isNotNull prepend="," property="yjjsfsx"><![CDATA[yjjsfsx =#yjjsfsx#]]></isNotNull>
			<isNotNull prepend="," property="wjjsfsx"><![CDATA[ wjjsfsx=#wjjsfsx#]]></isNotNull>
			<isNotNull prepend="," property="zzyldd"><![CDATA[ zzyldd=#zzyldd#]]></isNotNull>
			<isNotNull prepend="," property="jfbm"><![CDATA[jfbm =#jfbm#]]></isNotNull>
			<isNotNull prepend="," property="cfqk"><![CDATA[cfqk =#cfqk#]]></isNotNull>
			<isNotNull prepend="," property="bz"><![CDATA[ bz=#bz#]]></isNotNull>,
			<include refid="updateXtzd"/>				
		</dynamic>
		<![CDATA[ where ID = #id#]]>	
	</update>
	
	<!-- 注销 -->
	<update id="delete" parameterClass="zdryShbzdryxxb">
		<![CDATA[ update ZDRY_SHBZDRYXXB set ]]><include refid="deleteXtzd"/><![CDATA[ where ID = #id# ]]>	
	</update>
	
	
	
		<!-- 涉环保重点人员列表数据  -->
	<select id="query" parameterClass="Map" resultClass="zdryZdryzb">
	       <![CDATA[SELECT * FROM ( SELECT ROWNUM R ,M.* FROM (
		       SELECT * 
		          FROM ZDRY_ZDRYZB T2 
		       WHERE T2.XT_ZXBZ = '0' and T2.ZDRYGLLXDM='7' and T2.GLZT in(2,3,5)  AND (T2.xt_lrrbmid = #zdryZdryzb.sszrqdm# OR T2.ssfxjdm = #zdryZdryzb.sszrqdm#)]]> 
		       <isNotEmpty prepend="AND" property="zdryZdryzb.xm">
		            T2.XM LIKE '%'||#zdryZdryzb.xm#||'%'
		       </isNotEmpty>
		       <isNotEmpty prepend="AND" property="zdryZdryzb.zjhm">
		       		T2.ZJHM LIKE '%'||#zdryZdryzb.zjhm#||'%'		       
		       </isNotEmpty>
		       <isNotEmpty prepend="AND" property="zdryZdryzb.dz_jzdzxz">
		       		T2.dz_jzdzxz LIKE '%'||#zdryZdryzb.dz_jzdzxz#||'%'		       
		       </isNotEmpty>
		  <![CDATA[  ORDER BY T2.$sort$ $order$) M  WHERE ROWNUM <= #end# ) WHERE R > #begin#]]> 
	</select>
	
	<!--列表总数统计 -->
    <select id="queryCount" parameterClass="Map" resultClass="Integer">
		    <![CDATA[
		       SELECT count(1)
		          FROM ZDRY_ZDRYZB T2 
		       WHERE T2.XT_ZXBZ = '0' and T2.ZDRYGLLXDM='7' and T2.GLZT in(2,3,5) AND (T2.xt_lrrbmid = #zdryZdryzb.sszrqdm# OR T2.ssfxjdm = #zdryZdryzb.sszrqdm#)  ]]> 
		       <isNotEmpty prepend="AND" property="zdryZdryzb.xm">
		            T2.XM LIKE '%'||#zdryZdryzb.xm#||'%'
		       </isNotEmpty>
		       <isNotEmpty prepend="AND" property="zdryZdryzb.zjhm">
		       		T2.ZJHM LIKE '%'||#zdryZdryzb.zjhm#||'%'		       
		       </isNotEmpty>
		       <isNotEmpty prepend="AND" property="zdryZdryzb.dz_jzdzxz">
		       		T2.dz_jzdzxz LIKE '%'||#zdryZdryzb.dz_jzdzxz#||'%'		       
		       </isNotEmpty>
	</select>
</sqlMap>