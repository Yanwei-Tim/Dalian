<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
	"http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="OpeLogDev">
	<typeAlias alias="serviceLog" type="com.founder.framework.entity.ServiceRestLog" />
	<typeAlias alias="OperationLog" type="com.founder.framework.entity.OperationLog" />
	<insert id="insertInfoLog" parameterClass="operLog">
		insert into LOG_INFO (NUM_ID, USER_ID,ORGANIZATION,USER_NAME,TERMINAL_ID,OPERATE_TIME,OPERATE_CONDITION,
		OPERATE_RESULT,MODNAME,FUNCNAME,OPERATE_TYPE,TABLE_NAME,TABLE_PK,OPERATE_CONTENT,QUERY_FILED ,OPERATE_JSONCONTENT)
		values(SEQ_PK.NEXTVAL , #user_id# ,#organization# ,#user_name# ,#terminal_id#,#operation_time#,
		#operate_condition#,#operate_result#,#modName#,#funcName#,#operate_type#,
		#table_name#,#table_pk#,#operate_content#,#query_filed#,#operate_jsonContent#)
	</insert>
	
	<select id="queryObj" parameterClass="Map" resultClass="java.util.HashMap" remapResults="true">
		select * from $tablename$ where $pk$ = #id# 
	</select>
	
	<insert id="insertServiceLog" parameterClass="serviceLog">
		insert into RESTFUL_RZB (ID,REQUESTCONTENT,RESPONSECONTENT,STATUS,REQUESTTIME,USERID,SERVICEID,SERVICENAME,ERROR,BZ,XT_CJSJ)
		values(#id#,#requestcontent#,#responsecontent#,#status#,#requesttime#,#userid#,#serviceid#,#servicename#,#error#,#bz#,#xt_cjsj#)
	</insert>

	<select id="queryById" parameterClass="String" resultClass="OperationLog" remapResults="true">
		select * from LOG_INFO where NUM_ID= #num_id#
	</select>
	
	<select id="queryListByEntity" parameterClass="OperationLog" resultClass="OperationLog" remapResults="true">
		<![CDATA[ select * from LOG_INFO where 1=1 ]]>
			<isNotEmpty prepend="and" property="num_id"> NUM_ID = #num_id#</isNotEmpty>
			<isNotEmpty prepend="and" property="user_id"> USER_ID = #user_id#</isNotEmpty>
			<isNotEmpty prepend="and" property="organization"> ORGANIZATION = #organization#</isNotEmpty>
			<isNotEmpty prepend="and" property="user_name"> USER_NAME = #user_name#</isNotEmpty>
			<isNotEmpty prepend="and" property="terminal_id"> TERMINAL_ID = #terminal_id#</isNotEmpty>
			<isNotEmpty prepend="and" property="operation_time"> OPERATE_TIME = #operation_time#</isNotEmpty>	
			<isNotEqual prepend="and" property="operate_result" compareValue="0"> OPERATE_RESULT = #operate_result# </isNotEqual>					
			<isNotEmpty prepend="and" property="modName"> MODNAME = #modName#</isNotEmpty>
			<isNotEmpty prepend="and" property="funcName"> FUNCNAME = #funcName#</isNotEmpty>
			<isNotEqual prepend="and" property="operate_type" compareValue="0"> OPERATE_TYPE = #operate_type# </isNotEqual>
			<isNotEmpty prepend="and" property="table_name"> TABLE_NAME = #table_name#</isNotEmpty>
			<isNotEmpty prepend="and" property="table_pk"> TABLE_PK = #table_pk#</isNotEmpty>			
			<isNotEmpty prepend="and" property="query_filed"> QUERY_FILED = #query_filed#</isNotEmpty>					
	</select>	
	
	<select id="queryListByColName" parameterClass="String" resultClass="java.lang.String" remapResults="true">
		select distinct $colName$ from log_info
	</select>
	
	<select id="countByColAndVale" parameterClass="Map" resultClass="java.lang.Integer" remapResults="true">
		<![CDATA[ select count(*) from LOG_INFO where $colName$ = #value# ]]>
		<isNotEmpty prepend="and" property="startDate"><![CDATA[ OPERATE_TIME >= #startDate# ]]></isNotEmpty>
		<isNotEmpty prepend="and" property="endDate"><![CDATA[ OPERATE_TIME < #endDate# ]]></isNotEmpty>
	</select>
</sqlMap>